{% extends "base.html" %}

{% block title %}Data Management{% endblock %}

{% block content %}
<style>
    .page-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        align-items: flex-start;
    }
    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0 25px;
        align-items: flex-end;
    }
    .form-group { margin-bottom: 20px; }
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--text-secondary);
    }
    .form-group select {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
    }
    .summary-table {
        width: 100%;
        border-collapse: collapse;
    }
    .summary-table td {
        padding: 8px 0;
        border-bottom: 1px solid var(--border-color);
    }
    .summary-table .count {
        text-align: right;
        font-weight: 600;
    }
    button {
        background-color: var(--accent-color);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
    }
</style>

<h1>Data Management & Summaries</h1>

<div class="card">
    <h2>Export Employee Data</h2>
    <form method="POST" action="{{ url_for('data_management') }}">
        <div class="form-grid">
            <div class="form-group">
                <label for="download_type">Filter By</label>
                <select name="download_type" id="download_type">
                    <option value="all">All Records</option>
                    <option value="accommodation">Accommodation</option>
                    <option value="location">Location</option>
                    <option value="status">Status</option>
                    <option value="nationality">Nationality</option>
                </select>
            </div>
            <div class="form-group">
                <label for="filter_value">Value</label>
                <select name="filter_value" id="filter_value">
                    <option value="">-- Select Filter First --</option>
                </select>
            </div>
        </div>
        <button type="submit">Download Excel File</button>
    </form>
</div>

<div class="page-grid">
    <div class="card">
        <h2>Summary by Designation</h2>
        <table class="summary-table">
            <tbody>
                {% for designation, count in designation_summary %}
                <tr>
                    <td>{{ designation }}</td>
                    <td class="count">{{ count }}</td>
                </tr>
                {% else %}
                <tr>
                    <td>No data available.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="card">
        <h2>Summary by Nationality</h2>
        <table class="summary-table">
            <tbody>
                {% for nationality, count in nationality_summary %}
                <tr>
                    <td>{{ nationality }}</td>
                    <td class="count">{{ count }}</td>
                </tr>
                {% else %}
                <tr>
                    <td>No data available.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    const filterOptions = {
        accommodation: {{ accommodations | tojson | safe }},
        location: {{ locations | tojson | safe }},
        status: {{ statuses | tojson | safe }},
        nationality: {{ nationalities | tojson | safe }}
    };

    const typeSelect = document.getElementById('download_type');
    const valueSelect = document.getElementById('filter_value');

    typeSelect.addEventListener('change', function() {
        const selectedType = this.value;
        valueSelect.innerHTML = ''; 

        if (selectedType && filterOptions[selectedType]) {
            let options = filterOptions[selectedType];
            
            valueSelect.add(new Option('-- Select Value --', ''));

            if (selectedType === 'accommodation') {
                 options.forEach(function(item) {
                    valueSelect.add(new Option(item.name, item.name));
                });
            } else {
                options.forEach(function(item) {
                    valueSelect.add(new Option(item, item));
                });
            }
        } else {
            valueSelect.add(new Option('-- Select Filter First --', ''));
        }
    });
</script>
{% endblock %}